"use strict";angular.module("networkStatus",[]).factory("ConnectionStatus",["$rootScope","$q","$injector","$interval","$timeout","appConfig","Alert",function(a,b,c,d,e,f,g){function h(){if(!k){k=!0;var b=d(function(){if(0===--a.connection.countDown){return c.get("$http").get("{0}/healthcheck".format([f.backendURL])).then(function(c){return"OK"===c.data.result&&(k=!1,d.cancel(b),a.connection.isApiAccessible=!0,a.connection.countDown=a.connection.refreshInterval,g.success("Sucesso","Sua conexão foi restabelecida, os dados serão recarregados."),d.cancel(b),e(function(){return location.reload(),c},a.connection.waitForNextTry*l)),a.connection.countDown=a.connection.refreshInterval+a.connection.waitForNextTry,a.connection.showTryFailed=!0,e(function(){a.connection.showTryFailed=!1},a.connection.waitForNextTry*l),c},function(b){return a.connection.countDown=a.connection.refreshInterval+a.connection.waitForNextTry,a.connection.showTryFailed=!0,e(function(){a.connection.showTryFailed=!1},a.connection.waitForNextTry*l),b})}},l)}}var i=0,j=0,k=!1;const l=1e3;return{request:function(d){return a.connection.countDown=a.connection.refreshInterval,d.url.indexOf("{0}/healthcheck".format([f.backendURL]))>-1?(j=+new Date,d):d.url.indexOf(".html")>-1?d:c.get("$http").get("{0}/healthcheck".format([f.backendURL])).then(function(c){return"OK"===c.data.result?(a.connection.isApiAccessible=!0,a.connection.countDown=a.connection.refreshInterval,d):(a.connection.isApiAccessible=!1,h(),b.reject(d))},function(c){return 502===c.status?(a.connection.isApiAccessible=!1,h(),b.reject(c.config)):c.config})},response:function(b){return b.config.url.indexOf("{0}/healthcheck".format([f.backendURL]))>-1&&(a.connection.isLatencyOkay=!0,(i=+new Date-j)>a.connection.maximumLatency*l&&(a.connection.isLatencyOkay=!1,a.connection.message="Sua conexão com a Internet está lenta")),b}}}]).directive("connectionStatus",["$rootScope","$interval",function(a,b){return{restrict:"E",replace:!0,template:function(){return["<li class=\"icon-wifi\" ng-class=\"{'iam-online': connection.iamOnline && connection.isLatencyOkay, 'iam-lagging': !connection.isLatencyOkay, 'iam-not-online': !connection.iamOnline}\" title=\"{{connection.message}}\">",'<i class="fa fa-wifi online" aria-hidden="true" ng-if="connection.iamOnline && connection.isLatencyOkay"></i>','<i class="fa fa-wifi lagging" aria-hidden="true" ng-if="!connection.isLatencyOkay"></i>','<img src="../img/notwifi.svg" class="offline" alt="" ng-if="!connection.iamOnline">',"</li>"].join("")},link:function(c,d,e,f){b(function(){a.connection.iamOnline=!1,a.connection.message="Você está sem conexão a Internet",navigator.onLine&&(a.connection.iamOnline=!0,a.connection.message="Você possui conexão com a internet",a.connection.isLatencyOkay||(a.connection.message="Sua conexão com a Internet está lenta"))},2e3)}}}]).directive("apiStatus",function(){return{restrict:"E",replace:!0,template:function(){return['<div id="showDinno" class="open-status-server" ng-class="{\'opened\': !connection.isApiAccessible}">','<section class="status-server container">',"<h3>Você não esta conseguindo se conectar com ao nosso servidor.</h3>","<span>",'<h4 ng-show="!connection.showTryFailed">Aguarde, tentaremos reconectar em {{connection.countDown}} segundos...</h4>',"</span>",'<span ng-show="connection.showTryFailed">',"<h4>Nova tentativa falhou, verifique sua conexão com a internet.</h4>","</span>",'<i class="fa fa-spinner fa-spin spiner-server"></i>',"</section>","</div>"].join("")}}});