"use strict";angular.module("network-status",[]).factory("ConnectionStatus",["$rootScope","$q","$injector","$interval","$timeout","appConfig",function(a,b,c,d,e,f){function g(){if(!j){j=!0;var b=d(function(){if(0===--a.connection.countDown){return c.get("$http").get("{0}/healthcheck".format([f.backendURL])).then(function(c){return"OK"===c.data.result?(j=!1,d.cancel(b),a.connection.isApiAccessible=!0,a.connection.countDown=15,c):(a.connection.countDown=18,a.connection.showTryFailed=!0,e(function(){a.connection.showTryFailed=!1},3e3),c)},function(b){return a.connection.countDown=18,a.connection.showTryFailed=!0,e(function(){a.connection.showTryFailed=!1},3e3),b})}},1e3,0)}}var h=0,i=0,j=!1;return{request:function(d){return d.url.indexOf("{0}/healthcheck".format([f.backendURL]))>-1?(i=+new Date,d):d.url.indexOf(".html")>-1?d:c.get("$http").get("{0}/healthcheck".format([f.backendURL])).then(function(c){return"OK"===c.data.result?(a.connection.isApiAccessible=!0,a.connection.countDown=15,d):(a.connection.isApiAccessible=!1,g(),b.reject(d))},function(c){return 502===c.status&&(a.connection.isApiAccessible=!1),g(),b.reject(d)})},requestError:function(c){if(502===c.status)return a.connection.isApiAccessible=!1,g(),b.reject(c)},response:function(b){return b.config.url.indexOf("{0}/healthcheck".format([f.backendURL]))>-1&&(a.connection.isLatencyOkay=!0,(h=+new Date-i)>1500&&(a.connection.isLatencyOkay=!1)),b}}}]).directive("connectionStatus",["$rootScope","$interval",function(a,b){return{restrict:"E",scope:{url:"@url",version:"@version",template:function(){return['<li class="iam-online" title="Você possui conexão com a internet" ng-if="connection.iamOnline && connection.isLatencyOkay"><i class="fa fa-wifi" aria-hidden="true"></i></li>','<li class="iam-lagging" title="Sua conexão com a internet está lenta" ng-if="!connection.isLatencyOkay"><i class="fa fa-wifi" aria-hidden="true"></i></li>','<li class="iam-not-online" title="Você não possui conexão com a internet" ng-if="!connection.iamOnline"><img src="../img/notwifi.svg" alt=""></li>'].join("")}},link:function(c,d,e,f){b(function(){a.connection.iamOnline=!1,navigator.onLine&&(a.connection.iamOnline=!0)},1500)}}}]).directive("apiStatus",["$rootScope","$httpProvider",function(a,b){return{restrict:"E",scope:{url:"@url",version:"@version",template:function(){return['<section class="status-server container">',"<h3>Você não esta conseguindo se conectar com ao nosso servidor.</h3>","<span>",'<h4 ng-show="!connection.showTryFailed">Aguarde, tentaremos reconectar em {{connection.countDown}} segundos...</h4>',"</span>",'<span ng-show="connection.showTryFailed">',"<h4>Nova tentativa falhou, verifique sua conexão com a internet.</h4>","</span>",'<div class="loader"></div>',"</section>"].join("")}},link:function(a,c,d,e){b.interceptors.push("ConnectionStatus")}}}]);